<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Prolog XO</title>

  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">

  <!-- Bootstrap 4.5 -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous"></script>
</head>

<body>
  <div id="app">

    <div id="content" class="container">

      <!-- Game info text -->
  <div class="content-wrapper">
      <div id="game_info" class="bodyBlock">
        <h3>Prolog XO</h3>
        <p>
              Bienvenido al clasico juego de tres en raya, con una vuelta de tuerca: la inteligencia del oponente fue programada en Prolog!<br>
              Elige tu simbolo, la dificultad del rival, y comienza a jugar.<br>
              Podras vencer a la IA logica?<br>
        </p>
      </div>

      <!-- Games options -->
      <div id="gameOptions" class="bodyBlock">
        <form class="form-inline">
          <div class="form-group">
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-primary" :disabled="playerSymbol === 'X'"
                @click="setSymbol('X')">X</button>
              <button type="button" class="btn btn-primary" :disabled="playerSymbol === 'O'"
                @click="setSymbol('O')">O</button>
            </div>
          </div>
          <div class="form-group d-flex flex-column">
            <label for="difficultySelect" class="font-weight-bold mb-1">Difficulty Level</label>
            <select id="difficultySelect" class="form-control" v-model="difficultyLevel">
              <option value="1">Facil</option>
              <option value="6">Medio</option>
              <option value="15">Dificil</option>
            </select>
          </div>

          <div class="form-group d-flex align-items-center">
            <label for="boardSizeInput" class="mb-0 mr-2 font-weight-bold">Board Size:</label>
            <input type="text" class="form-control-plaintext" id="boardSizeInput" v-model="boardSize" disabled />
          </div>

        </form>
      </div>

      <!-- Tic-tac-toe board -->
      <div id="theGame" class="bodyBlock">
        <table id="gameBoard">
          <tr v-for="(row, rowIndex) in board" class="">
            <td v-for="(cell, cellIndex) in row" class="boardCell" @click="makeMove(rowIndex, cellIndex)">
              {{ cell }}
            </td>
          </tr>
        </table>
      </div>


      <div id="gameOptions" class="bodyBlock">
        <form class="form-inline">
          <button type="button" class="btn btn-warning" @click="resizeBoard">Reset</button>
        </form>
      </div>
    </div>

    <!-- Boton reset -->
      
  </div>
    <!-- Info Modal -->
    <div class="modal fade" id="infoModal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">{{ infoModalText }}</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal" @click="resizeBoard">Close</button>
          </div>
        </div>
      </div>
    </div>

  </div>
  <!-- Vue.js -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <!-- Frontend Logic -->
  <script>
    const App = {
      data() {
        return {
          board: null,
          boardSize: 3,
          playerSymbol: "X",
          difficultyLevel: 1,
          maxDifficultyLevel: 9,
          infoModalText: null,
        }
      },

      mounted() {
        this.difficultyLevel = this.boardSize * this.boardSize;
        this.resizeBoard();
      },

      methods: {
        createBoard(size) {
          var newBoard = []
          for (var i = 0; i < size; i++) {
            newBoard[i] = [];
            for (var j = 0; j < size; j++) {
              newBoard[i][j] = "";
            }
          }
          return newBoard;
        },

        resizeBoard() {
          this.board = this.createBoard(this.boardSize);
          this.isWinner = null;
        },

        postJsonData() {
          return {
            board: this.board,
            difficultyLevel: this.difficultyLevel,
            symbol: this.playerSymbol
          }
        },

        makeMove(rowIndex, cellIndex) {
          if (this.board[rowIndex][cellIndex] !== "") {
            alert("Invalid move!");
          } else {
            this.board[rowIndex][cellIndex] = this.playerSymbol;
            axios.post("/api/make_move", this.postJsonData()).then(response => {
              this.board = response.data.board;
              this.getIsWinner();
            }).catch(() => {
              this.showInfoModal("It's too damm hard! please lower difficulty");
            });
          }
        },

        getIsWinner() {
          axios.post("/api/is_winner", this.postJsonData()).then(response => {
            isWinner = response.data.result;
            if (isWinner === true) {
              this.showInfoModal("You win!");
            } else if (isWinner === false) {
              this.showInfoModal("You lose!");
            } else if (this.checkIsDraw()) {
              this.showInfoModal("Game reached a draw");
            }
          });
        },

        checkIsDraw() {
          for (var i = 0; i < this.board.length; i++) {
            for (var j = 0; j < this.board[i].length; j++) {
              if (this.board[i][j] === "") {
                return false;
              }
            }
          }
          return true;
        },

        setSymbol(symbol) {
          this.playerSymbol = symbol;
          this.resizeBoard();
        },

        showInfoModal(text) {
          this.infoModalText = text;
          $("#infoModal").modal("show");
        },
      }
    }

    new Vue(App).$mount("#app");
    console.log(app);
  </script>

  <!-- Frontend Styling -->
  <style>
    .bodyBlock {
      margin-top: 25px;
      float: none;
    }

    .boardCell {
      height: 100px;
      width: 100px;
      text-align: center;
      vertical-align: middle;
      font-size: 65px;
      border: 1px solid black;
      cursor: pointer
    }

    .form-group {
      padding: 0 10px;
    }

    #boardSizeInput {
      width: 65px;
      text-align: center;
    }

    #content {
      max-width: 700px;
      margin: 0 auto;
      }

     #game_info, #gameOptions, #theGame {
       text-align: center;
      }

      #gameBoard {
        margin: auto;
        border-collapse: collapse;
      }

      #gameOptions form {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }

      body {
        background-image: url('static/img/mesa.png');
        background-repeat: repeat;
        background-size: cover;
        background-attachment: fixed;
        background-position: center;
        font-family: 'MedievalSharp', cursive;
      }

      .content-wrapper {
        position: relative;
        overflow: hidden;
        border: 5px solid rgba(91, 59, 30, 0.4);
        border-radius: 8px;
        padding: 10px 20px 20px 20px;
        max-width: 800px;
        margin: 10px auto;
        box-shadow: 0 0 15px rgba(91, 59, 30, 0.3);
        color: #000000;
        z-index: 1;
      }

      .content-wrapper::before {
        content: "";
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background-image: url('static/img/tabla.jpg');
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        opacity: 0.66;
        z-index: 0;
      }

      .content-wrapper > * {
        position: relative;
        z-index: 1;
      }

      .btn-primary {
        background-color: #6b4226 !important;  
        border-color: #c49e63 !important;      
        color: #fdf3e7 !important;             
        font-weight: bold;
      }

      .btn-primary:hover, .btn-primary:focus {
        background-color: #845c3e !important;
        border-color: #d9b785 !important;
        box-shadow: 0 0 10px #00000055;
      }


      select.form-control {
        background-color: #f2e6c8;
        border: 2px solid #a1845c;
        font-family: 'MedievalSharp', cursive;
        font-size: 18px;
        padding: 8px;
        border-radius: 8px;
      }

      .btn-warning {
        background-color: #c49e63;
        border: 2px solid #8b5e3c;
        font-family: 'MedievalSharp', cursive;
        font-size: 18px;
        color: #3e2f1c;
        box-shadow: 2px 2px 8px #00000060;
      }

      .btn-warning:hover {
        background-color: #e0b76f;
        transform: scale(1.05);
      }

      .boardCell {
        height: 100px;
        width: 100px;
        text-align: center;
        vertical-align: middle;
        font-size: 65px;
        border: 4px solid #000000; 
        border-style: double;      
        background-color: rgba(255, 248, 220, 0.1); 
        font-family: 'MedievalSharp', cursive;
      }

      #gameBoard td {
        border: none;
      }

      #gameBoard tr:not(:last-child) td {
        border-bottom: 4px solid #000000;
      }

      #gameBoard td:not(:last-child) {
        border-right: 4px solid #232323;
      }

      .boardCell {
        box-shadow: inset 0 0 10px #00000055;
        background-size: cover;
      }

      .content-wrapper h3,
      .content-wrapper p,
      .content-wrapper label {
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.542);
      }

  </style>
</body>

</html>